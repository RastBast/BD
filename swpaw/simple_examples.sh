#!/bin/bash

# –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Verb Extractor API
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./simple_examples.sh

set -e

API_URL="http://localhost:8080"
GREEN="\033[0;32m"
BLUE="\033[0;34m"
YELLOW="\033[1;33m"
RED="\033[0;31m"
NC="\033[0m" # No Color

echo -e "${GREEN}üöÄ –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø VERB EXTRACTOR API${NC}"
echo "=========================================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
echo -e "\n${YELLOW}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞...${NC}"
if curl -s "$API_URL/api/health" >/dev/null 2>&1; then
    echo -e "${GREEN}‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω${NC}"
    health_info=$(curl -s "$API_URL/api/health" | jq -r '.status + " (–≤–µ—Ä—Å–∏—è: " + .version + ")"' 2>/dev/null || echo "ok")
    echo "–°—Ç–∞—Ç—É—Å: $health_info"
else
    echo -e "${RED}‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω${NC}"
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: go run verb_extractor_server.go"
    exit 1
fi

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
test_text() {
    local description="$1"
    local text="$2"

    echo -e "\n${BLUE}üìù $description${NC}"
    echo "–¢–µ–∫—Å—Ç: "$text""

    # –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
    response=$(curl -s -X POST "$API_URL/api/extract-verbs" \
        -H "Content-Type: application/json" \
        -d "{\"text\":\"$text\"}")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏
    if echo "$response" | jq -e '.error' >/dev/null 2>&1; then
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ API:${NC}"
        echo "$response" | jq -r '.message' 2>/dev/null || echo "$response"
        return
    fi

    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    verb_count=$(echo "$response" | jq -r '.count' 2>/dev/null || echo "0")
    processing_time=$(echo "$response" | jq -r '.time' 2>/dev/null || echo "unknown")
    verbs=$(echo "$response" | jq -r '.verbs | join(", ")' 2>/dev/null || echo "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö")

    echo -e "${GREEN}‚úÖ –ù–∞–π–¥–µ–Ω–æ –≥–ª–∞–≥–æ–ª–æ–≤: $verb_count${NC}"
    if [ "$verb_count" -gt 0 ]; then
        echo "üìã –ì–ª–∞–≥–æ–ª—ã: $verbs"
    fi
    echo "‚è±Ô∏è  –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: $processing_time"
}

# –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã
echo -e "\n${YELLOW}üß™ –ë–ê–ó–û–í–´–ï –ü–†–ò–ú–ï–†–´${NC}"
echo "----------------------------------------"

test_text "–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä" "–Ø —á–∏—Ç–∞—é –∫–Ω–∏–≥—É –∏ –¥—É–º–∞—é –æ –∂–∏–∑–Ω–∏"

test_text "–†–∞–∑–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞" "–í—á–µ—Ä–∞ —è —á–∏—Ç–∞–ª, —Å–µ–≥–æ–¥–Ω—è —á–∏—Ç–∞—é, –∑–∞–≤—Ç—Ä–∞ –±—É–¥—É —á–∏—Ç–∞—Ç—å"

test_text "–í–æ–∑–≤—Ä–∞—Ç–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã" "–î–µ—Ç–∏ —É—á–∞—Ç—Å—è –≤ —à–∫–æ–ª–µ –∏ —Ä–∞–∑–≤–∏–≤–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ"

test_text "–ì–ª–∞–≥–æ–ª—ã –¥–≤–∏–∂–µ–Ω–∏—è" "–°—Ç—É–¥–µ–Ω—Ç –∏–¥–µ—Ç –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç, –±–µ–∂–∏—Ç –Ω–∞ –ª–µ–∫—Ü–∏—é, –µ–¥–µ—Ç –¥–æ–º–æ–π"

# –°–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏
echo -e "\n${YELLOW}üß™ –°–õ–û–ñ–ù–´–ï –°–õ–£–ß–ê–ò${NC}"
echo "----------------------------------------"

test_text "–ü—Ä–æ–±–ª–µ–º–∞ –∏–∑ –∑–∞–¥–∞–Ω–∏—è (—É–¥–∞—Ä–∏–ª/—É–¥–∞—Ä–∏—Ç—å/—É–¥–∞—Ä—è—é)" \
    "–û–Ω —É–¥–∞—Ä–∏–ª –º—è—á. –ù—É–∂–Ω–æ —É–¥–∞—Ä–∏—Ç—å —Ç–æ—á–Ω–æ. –Ø —É–¥–∞—Ä—è—é –ø–æ —Ü–µ–ª–∏. –í—Å–µ —É–¥–∞—Ä–∏–ª–∏ –ø–æ –º–∏—à–µ–Ω–∏."

test_text "–ì–ª–∞–≥–æ–ª—ã —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–∞–º–∏" \
    "–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∫–æ–¥, –¥–æ–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∑–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Å–ø–∏—Å–∞—Ç—å —Å –¥–æ—Å–∫–∏"

test_text "–ú–æ–¥–∞–ª—å–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã" \
    "–Ø –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å, –º–æ–≥—É –ø–æ–º–æ—á—å, —Ö–æ—á—É —É—á–∏—Ç—å—Å—è, –±—É–¥—É —Å—Ç–∞—Ä–∞—Ç—å—Å—è"

# –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ì–ü–ú–†–ú
echo -e "\n${YELLOW}üß™ –ü–†–ò–ú–ï–†–´ –ò–ó –ì–ê–†–†–ò –ü–û–¢–¢–ï–†–ê –ò –ú–ï–¢–û–î–û–í –†–ê–¶–ò–û–ù–ê–õ–¨–ù–û–ì–û –ú–´–®–õ–ï–ù–ò–Ø${NC}"
echo "----------------------------------------------------------------"

test_text "–§—Ä–∞–≥–º–µ–Ω—Ç –æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –ì–∞—Ä—Ä–∏" \
    "–ì–∞—Ä—Ä–∏ –∏–∑—É—á–∞–ª –Ω–∞—É–∫—É –∏ —á–∏—Ç–∞–ª –∫–Ω–∏–≥–∏. –û–Ω –¥—É–º–∞–ª –æ –º–∏—Ä–µ –∏ —Ö–æ—Ç–µ–ª –ø–æ–Ω—è—Ç—å –µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ. –ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä —É—á–∏–ª –µ–≥–æ –ª–æ–≥–∏–∫–µ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º—É –º—ã—à–ª–µ–Ω–∏—é."

test_text "–§—Ä–∞–≥–º–µ–Ω—Ç –æ –Ω–∞—É—á–Ω–æ–º –º–µ—Ç–æ–¥–µ" \
    "–ú–∞–ª—å—á–∏–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–≤–æ–¥–∏–ª —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã. –°—Ç—É–¥–µ–Ω—Ç—ã —Å–ª—É—à–∞–ª–∏ –ª–µ–∫—Ü–∏–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–ª–∏ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã."

test_text "–§—Ä–∞–≥–º–µ–Ω—Ç –æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö" \
    "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–∏ –∏–∑—É—á–∞—é—Ç –Ω–æ–≤—ã–µ —è–≤–ª–µ–Ω–∏—è –∏ –ø—É–±–ª–∏–∫—É—é—Ç —Å–≤–æ–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è. –£—á–µ–Ω—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–¥ –≤–∞–∂–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏."

# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ–∫—Å—Ç—ã
echo -e "\n${YELLOW}üß™ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–ï–ö–°–¢–´${NC}"
echo "----------------------------------------"

test_text "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ" \
    "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø–∏—à–µ—Ç –∫–æ–¥, —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏, –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ –∏ –¥–µ–ø–ª–æ–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ."

test_text "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" \
    "–ò–Ω–∂–µ–Ω–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –∏—Å—Å–ª–µ–¥—É—é—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –º–æ–¥–µ–ª–∏—Ä—É—é—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã."

test_text "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" \
    "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –æ–±—ä—è—Å–Ω—è—é—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∑–Ω–∞–Ω–∏—è, —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∫—É—Ä—Å—ã."

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
echo -e "\n${YELLOW}üìä –¢–ï–°–¢ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò${NC}"
echo "----------------------------------------"

echo -e "${BLUE}–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏...${NC}"

# –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç - 5 –∑–∞–ø—Ä–æ—Å–æ–≤
echo "–ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç (5 –∑–∞–ø—Ä–æ—Å–æ–≤):"
for i in {1..5}; do
    start_time=$(date +%s%3N)
    response=$(curl -s -X POST "$API_URL/api/extract-verbs" \
        -H "Content-Type: application/json" \
        -d '{"text":"–Ø —á–∏—Ç–∞—é –∏ –ø–∏—à—É –∫–æ–¥"}')
    end_time=$(date +%s%3N)
    duration=$((end_time - start_time))

    verb_count=$(echo "$response" | jq -r '.count' 2>/dev/null || echo "0")
    echo "  –ó–∞–ø—Ä–æ—Å $i: ${duration}ms, –≥–ª–∞–≥–æ–ª–æ–≤: $verb_count"
done

# –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Å–µ—Ä–≤–µ—Ä–∞
echo -e "\n${YELLOW}üìà –ú–ï–¢–†–ò–ö–ò –°–ï–†–í–ï–†–ê${NC}"
echo "----------------------------------------"

metrics=$(curl -s "$API_URL/api/metrics")
if [ $? -eq 0 ]; then
    echo "üìä –ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞:"
    echo "$metrics" | jq . 2>/dev/null || echo "$metrics"
else
    echo "‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏"
fi

# –ò—Ç–æ–≥–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
echo -e "\n${GREEN}üéâ –í–°–ï –ü–†–ò–ú–ï–†–´ –í–´–ü–û–õ–ù–ï–ù–´${NC}"
echo "=========================================================="

echo -e "\nüí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "  ‚Ä¢ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞: go run verb_extractor_server.go"
echo "  ‚Ä¢ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8080/"
echo "  ‚Ä¢ Health check: curl $API_URL/api/health"
echo "  ‚Ä¢ –†—É—á–Ω–æ–π —Ç–µ—Å—Ç: curl -X POST $API_URL/api/extract-verbs -H 'Content-Type: application/json' -d '{"text":"–≤–∞—à —Ç–µ–∫—Å—Ç"}'"

echo -e "\nüìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:"
echo "  ‚Ä¢ ./simple_load_test.sh - –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
echo "  ‚Ä¢ ./test_api.sh - –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API"
